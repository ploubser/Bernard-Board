<%%= f.error_messages %>
<% for attribute in attributes -%>

<p>
  <%%= f.label :<%= attribute.name %> %><br />
  <%%= f.<%= attribute.field_type %> :<%= attribute.name %> %>
</p>
<% end -%>
<% child_models.each do |child_model| -%>

<div id='<%= child_model.name.underscore %>_children'>
  <%% f.fields_for :<%= child_model.name.underscore.pluralize %> do |<%= child_model.name.underscore %>_form| %>
    <%%= render :partial => '<%= child_model.name.underscore %>', :locals => { :f => <%= child_model.name.underscore %>_form } %>
  <%% end %>
</div>

<p>
  <%%= add_child_link 'Add <%= child_model.name %>', '<%= child_model.name.underscore %>', f %>
</p>
<% end -%>
